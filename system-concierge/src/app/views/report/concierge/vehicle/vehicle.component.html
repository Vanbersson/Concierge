<div class="layout-card">
    <p-toast />
    <div class="layout-card-title">
        <span>Relatório de veículos</span>
        <p-button icon="pi pi-refresh" [text]="true" label="Limpar" (onClick)="cleanList()" />
    </div>
    <p-table #dt1 dataKey="id" [value]="listVehicleEntry" [rowHover]="true" 
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} entradas"
        [globalFilterFields]="['id', 'placa', 'modelDescription', 'frota', 'numServiceOrder', 'dateEntry','dateExit','clientCompanyName','nameUserAttendant','budgetStatus']"
        [paginator]="true" [rows]="10" [rowsPerPageOptions]="[10, 25, 50]" [showCurrentPageReport]="true"
        [tableStyle]="{ 'min-width': '100rem' }"  styleClass="p-datatable-sm">
        <ng-template pTemplate="caption">
            <div class="flex justify-content-between">
                <p-iconField iconPosition="left">
                    <p-inputIcon>
                        <i class="pi pi-search"></i>
                    </p-inputIcon>
                    <input pInputText type="text" (input)="dt1.filterGlobal($event.target.value, 'contains')" placeholder="Pesquisar" />
                </p-iconField>
                <div class="layout-mobile-button">
                    <button pButton [disabled]="disabledExport" type="button" [text]="true" severity="success" (click)="exportExcel()">
                        <i class="pi pi-file-excel"></i>
                        <span>Excel</span>
                    </button>
                    <button pButton type="button" [text]="true" severity="warning" (click)="showDialog()">
                        <i class="pi pi-filter"></i>
                        <span>Filtros</span>
                    </button>
                </div>
            </div>
        </ng-template>
        <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="id">
                    Código <p-sortIcon field="id" />
                </th>
                <th pSortableColumn="placa">
                    Placa <p-sortIcon field="placa" />
                </th>
                <th pSortableColumn="modelDescription">
                    Modelo <p-sortIcon field="modelDescription" />
                </th>
                <th pSortableColumn="frota">
                    Frota <p-sortIcon field="frota" />
                </th>
                <th pSortableColumn="numServiceOrder">
                    Nr O.S. <p-sortIcon field="numServiceOrder" />
                </th>
                <th pSortableColumn="dateEntry">
                    Entrada <p-sortIcon field="dateEntry" />
                </th>
                <th pSortableColumn="dateExit" >
                    Saída <p-sortIcon field="dateExit" />
                </th>
                <th pSortableColumn="clientCompanyName">
                    Empresa <p-sortIcon field="clientCompanyName" />
                </th>
                <th pSortableColumn="nameUserAttendant">
                    Consultor <p-sortIcon field="nameUserAttendant" />
                </th>
                <th pSortableColumn="budgetStatus">
                    Orçamento <p-sortIcon field="budgetStatus" />
                </th>
                <th>
                    Ver
                </th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-vehicle>
            <tr>
                <td><span class="text-500">{{ vehicle.id }}</span></td>
                <td>
                    @if(vehicle.placa == "NOVO"){
                    <div class="flex align-items-center justify-content-center bg-blue-100 border-round"
                        [ngStyle]="{width: '3.5rem', height: '2.5rem'}">
                        <span class="text-500">NOVO</span>
                    </div>
                    }@else {
                    <span class="text-500">{{vehicle.placa}}</span>
                    }
                </td>
                <td><span class="text-500">{{ vehicle.modelDescription}}</span>
                </td>
                <td><span class="text-500">{{ vehicle.frota}}</span></td>
                <td><span class="text-500">{{ vehicle.numServiceOrder}}</span></td>
                <td><span class="text-500">{{ vehicle.dateEntry }}</span></td>
                <td><span class="text-500">{{ vehicle.dateExit }}</span></td>
                <td>
                    <span class="text-500">{{ vehicle.clientCompanyName | uppercase }}</span>
                </td>
                <td>
                    <span class="text-500">{{ vehicle.nameUserAttendant}}</span>
                </td>
                <td><p-tag [value]="vehicle.budgetStatus" [severity]="getSeverity(vehicle.budgetStatus)"></p-tag></td>
                <td>
                    <p-button icon="pi pi-eye" label="Visualizar" [text]="true" severity="secondary" (onClick)="showVeiculo(vehicle.id)"/>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>

<p-dialog [(visible)]="dialogVisible" header="Filtros" [modal]="true" [style]="{ width: '74rem',height:'58rem' }"
    [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }" [maximizable]="true">
    <form [formGroup]="formFilter" class="layout-card-filter">
        <div class="p-fluid p-formgrid grid">
            <div class="col-12 flex justify-content-end mt-2">
                <p-button icon="pi pi-refresh" [text]="true" label="Limpar" (onClick)="cleanform()" />
            </div>
            <div class="col-12 md:col-3">
                <label for="dateIniId">Período inicial</label>
                <p-calendar [iconDisplay]="'input'" [showIcon]="true" inputId="buttondisplay" formControlName="dateInit" />
            </div>
            <div class="col-12 md:col-3">
                <label for="dateIniId">Período final</label>
                <p-calendar [iconDisplay]="'input'" [showIcon]="true" inputId="buttondisplay" formControlName="dateFinal" />
            </div>
            <div class="md:col-6"></div>
            <div class="col-12 md:col-6 ">
                <label for="">Tipo</label>
                <div class="flex align-items-center gap-2 border-1 border-round border-300 p-3">
                    <div class="flex align-items-center">
                        <p-radioButton value="E" inputId="type1" formControlName="type"></p-radioButton>
                        <label for="type1" class="ml-2">
                            Entrada
                        </label>
                    </div>
                    <div class="flex align-items-center">
                        <p-radioButton value="S" inputId="type2" formControlName="type"></p-radioButton>
                        <label for="type2" class="ml-2">
                            Saída
                        </label>
                    </div>
                    <div class="flex align-items-center">
                        <p-radioButton value="A" inputId="type3" formControlName="type"></p-radioButton>
                        <label for="type3" class="ml-2">
                            Ambos
                        </label>
                    </div>
                </div>
            </div>
            <div class="col-12 md:col-3">
                <label>Veículos Novos</label>
                <div class="flex align-items-center gap-2 p-3 border-1 border-round border-300">
                    <p-checkbox formControlName="vehicleNew" value="yes" inputId="vehicleNewId" />
                    <label for="vehicleNewId">Sim</label>
                </div>
            </div>
            <div class="md:col-3"></div>
            <div class="col-12 md:col-4">
                <label for="vehiclemodelid">Modelos</label>
                <p-multiSelect [options]="vehicleModels$ | async" [selectionLimit]="1" placeholder="Selecione" optionLabel="description" formControlName="modelVehicle">
                    <ng-template let-value pTemplate="selectedItems">
                        <div class="inline-flex align-items-center gap-2" *ngFor="let model of value">
                            <img *ngIf="model.photo" src="data:image/png;base64,{{model.photo}}" alt="photo vehicle" height="15" width="15"/>
                            <div >{{ model.description }}</div>
                        </div>
                        <div *ngIf="!value || value.length === 0">Selecione</div>
                    </ng-template>
                    <ng-template let-model pTemplate="item">
                        <div class="flex align-items-center gap-2">
                            <img *ngIf="model.photo" src="data:image/png;base64,{{model.photo}}" alt="photo vehicle" height="22" width="22"/>
                            <div>{{ model.description }}</div>
                        </div>
                    </ng-template>
                </p-multiSelect>
            </div>
            <div class="md:col-8"></div>
            <div class="col-12 md:col-2">
                <label for="clientCompanyCodeId">Código</label>
                <p-inputNumber inputId="clientCompanyCodeId" mode="decimal" [useGrouping]="false" formControlName="clientCompanyId" />
            </div>
            <div class="col-10 md:col-6">
                <label for="clientCompanyNameId">Empresa</label>
                <input pInputText id="clientCompanyNameId" type="text" formControlName="clientCompanyName" />
            </div>
            <div class="col-2 md:col-1">
                <label for="">Filtro</label>
                <app-filterclient (outputClient)="selectClientCompany.set($event)" />
            </div>          
            <div class="md:col-3"></div>
            <div class=" col-12 md:col-2">
                <label for="codeId">Código</label>
                <p-inputNumber inputId="codeId" mode="decimal" [useGrouping]="false" formControlName="vehicleId" />
            </div>
            <div class=" col-12 md:col-2">
                <label for="placaId">Placa</label>
                <p-inputMask id="placaId" mask="***-****" [unmask]="true" [style]="{'text-transform':'uppercase'}" formControlName="placa" />
            </div>
            <div class=" col-12 md:col-2">
                <label for="frotaId">Frota</label>
                 <p-inputNumber inputId="frotaId" [useGrouping]="false" maxlength="10" formControlName="frota" />
            </div>
            <div class="md:col-6"></div>
        </div>
    </form>
    <div class="flex justify-content-end gap-2 mt-4">
        <button pButton type="button" pRipple label="Fechar" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"></button>
        <button pButton type="button" pRipple label="Pesquisar" icon="pi pi-search" class="p-button-text" (click)="searchFilter()"></button>
    </div>
</p-dialog>

<p-dialog [(visible)]="dialogVisibleVehicleDetails" [modal]="true" [style]="{ width: '110rem',height:'60rem' }">
    <app-manutencao #detailsVehicle/>
</p-dialog>